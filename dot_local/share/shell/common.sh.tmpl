#!/bin/sh

# shellcheck source=./lib.sh.tmpl
. "{{ .xdg.dataDir }}/shell/lib.sh"

# [ENV] XDG Base Directories
################################################################################
export XDG_CACHE_HOME="{{ .xdg.cacheDir }}"
export XDG_CONFIG_HOME="{{ .xdg.configDir }}"
export XDG_DATA_HOME="{{ .xdg.dataDir }}"
export XDG_STATE_HOME="{{ .xdg.stateDir }}"

# [ENV] XDG Directory Mappings
################################################################################
export _JAVA_OPTIONS="-Djava.util.prefs.userRoot=\"${XDG_CONFIG_HOME}/java\""
export AWS_CONFIG_FILE="${XDG_CONFIG_HOME}/aws/config"
export AWS_SHARED_CREDENTIALS_FILE="${XDG_CONFIG_HOME}/aws/credentials"
export CARGO_HOME="${XDG_DATA_HOME}/cargo"
export FFMPEG_DATADIR="${XDG_CONFIG_HOME}/ffmpeg"
export GOPATH="${XDG_DATA_HOME}/go"
export NODE_REPL_HISTORY="${XDG_DATA_HOME}/node_repl_history"
export NVM_DIR="${XDG_DATA_HOME}/nvm"
export PYTHON_EGG_CACHE="${XDG_CACHE_HOME}/python-eggs"
export WGETRC="${XDG_CONFIG_HOME}/wgetrc"

# [ENV] Path
################################################################################
dot_path_prepend "${HOME}/.local/bin"

# [ENV] Editor
################################################################################
EDITOR="$(dot_alternative vim nano vi)"
export EDITOR

# [ENV] Locale
################################################################################
export LANG="${LANG:-en_US.UTF-8}"
export LC_ALL="${LC_ALL:-en_US.UTF-8}"

# [ENV] Utilities
################################################################################
export GOPROXY="https://proxy.golang.org,direct"
export MANPAGER="less -X"
export PYTHONIOENCODING="UTF-8"

# [ALIAS] Nesting
################################################################################
alias sudo="sudo "
alias watch="watch "
alias xargs="xargs "

# [ALIAS] Directory Traversal
################################################################################
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."

# [ALIAS] Directory Listings
################################################################################
alias ls="command ls --color"
alias l="ls -lF"
alias la="ls -lAF"
alias lsd="ls -lF | grep --color=never '^d'"

# [ALIAS] Safety Measures
################################################################################
alias cp="cp -i"
alias mv="mv -i"

# {{- if eq .chezmoi.os "linux" }}
alias chgrp="chgrp --preserve-root"
alias chmod="chmod --preserve-root"
alias chown="chown --preserve-root"
alias rm="rm -I --preserve-root"
# {{- end }}

# [ALIAS] Colored Output
################################################################################
alias grep="grep --color=auto"
alias egrep="egrep --color=auto"
alias fgrep="fgrep --color=auto"

# [ALIAS] Shell Helpers
################################################################################
alias bell="tput bel"
alias map="xargs -n1"
alias path='echo -e "${PATH//:/\\n}"'
alias reload='exec ${SHELL} -l'

# [ALIAS] Compatibility
################################################################################
dot_has hd || alias hd="hexdump -C"
dot_has md5sum || alias md5sum="md5"
dot_has sha1sum || alias sha1sum="shasum -a 1"
dot_has sha256sum || alias sha256sum="shasum -a 256"
dot_has sha512sum || alias sha512sum="shasum -a 512"

# [ALIAS] Shortcuts
################################################################################
dot_has docker && alias d="docker"
dot_has git && alias g="git"
dot_has kubectl && alias k="kubectl"

# [ALIAS] Miscellaneous
################################################################################
alias clip="tr -d '\n' | pbcopy"
alias mip4="curl https://ipv4.icanhazip.com"
alias mip6="curl https://ipv6.icanhazip.com"
alias week='date +%V'

# [ALIAS] Open Command
################################################################################
# {{- if eq .chezmoi.os "linux" }}
alias open='xdg-open'
# {{- else if eq .chezmoi.os "windows" }}
alias open='explorer.exe'
# {{- end }}

# [FUNCTION] Make & Enter Directory
################################################################################
mkd() {
	mkdir -vp "$@" && cd "${1}" || return
}

# [FUNCTION] DNS Query
################################################################################
dns() {
	dig +nocmd +multiline +noall +answer "${@}"
}

# [FUNCTION] Open Directory from File Manager
################################################################################
cdf() {
	cd "$(osascript -e 'tell app "Finder" to POSIX path of (insertion location as alias)')" || return
}

# [FUNCTION] Open Directory with File Manager
################################################################################
o() {
	if [ $# -eq 0 ]; then
		open .
	else
		open "${@}"
	fi
}
